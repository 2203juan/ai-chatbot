---
// Script para asegurar que el JS corre en el cliente
const props = Astro.props;
---

<script client:load>
  function sendChatMessage() {
    const inputElement = document.getElementById('chat-input');
    const message = inputElement.value;
    const chatContent = document.getElementById('chat-content');

    if (message.trim()) {
      // Muestra el mensaje en el cliente
      const userMessage = document.createElement('div');
      userMessage.textContent = `Tú: ${message}`;
      chatContent.appendChild(userMessage);

      // Envía el mensaje al servidor backend
      fetch('http://localhost:5000/api/send-message', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ message: message })
      })
      .then(response => response.json())
      .then(data => {
        const botReply = document.createElement('div');
        botReply.textContent = `Bot: ${data.reply}`;
        chatContent.appendChild(botReply);
        chatContent.scrollTop = chatContent.scrollHeight;
      })
      .catch(error => {
        console.error('Error:', error);
      });

      inputElement.value = ''; // Limpia el campo de entrada
    }
  }
</script>

<style>
  .chatbot-container {
    background-color: #e8f5e9; /* Verde claro */
    border-radius: 8px;
    width: 100%;
    max-width: 400px;
    margin: 20px auto; /* Centra el contenedor */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .chat-header {
    background-color: #66bb6a; /* Verde orgánico */
    color: white;
    padding: 10px;
    text-align: center;
  }

  .chat-content {
    padding: 10px;
    height: 300px;
    overflow-y: auto;
    background-color: #ffffff;
  }

  .chat-input {
    display: flex;
    border-top: 1px solid #e0e0e0;
  }

  .chat-input input {
    width: 100%;
    padding: 10px;
    border: none;
    outline: none;
  }

  .chat-input button {
    background-color: #66bb6a;
    border: none;
    color: white;
    padding: 10px;
    cursor: pointer;
  }
</style>

<div class="chatbot-container">
  <div class="chat-header">
    GreenStore Food Chatbot
  </div>
  <div class="chat-content" id="chat-content">
    <!-- Aquí se mostrarán los mensajes -->
  </div>
  <div class="chat-input">
    <input type="text" placeholder="Escribe un mensaje..." id="chat-input" />
    <button onclick="sendChatMessage()">Enviar</button>
  </div>
</div>